<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline'; media-src 'self' blob:; img-src 'self' data: blob:;">
    <title>Car Infotainment System</title>
    <link rel="stylesheet" href="src/css/styles.css">
    <!-- jsmediatags for reading audio metadata -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsmediatags/3.9.5/jsmediatags.min.js"></script>
</head>

<body>
    <!-- Quick Settings Dropdown -->
    <div class="quick-settings-dropdown" id="quickSettingsDropdown">
        <div class="quick-settings-content">
            <div class="quick-settings-header">
                <h3>Quick Settings</h3>
                <button class="close-dropdown-btn" id="closeDropdownBtn">‚úï</button>
            </div>
            <div class="quick-setting-item">
                <div class="quick-setting-label">
                    <span class="control-icon" id="muteBtn">üîä</span>
                    <span>Volume</span>
                </div>
                <input type="range" id="output" min="0" max="100" value="50">
            </div>
            <div class="quick-setting-item">
                <div class="quick-setting-label">
                    <span class="control-icon">‚òÄÔ∏è</span>
                    <span>Brightness</span>
                </div>
                <input type="range" id="brightnessSlider" min="0" max="100" value="80">
            </div>
        </div>
    </div>

    <div class="infotainment">
        <div class="status-bar">
            <div class="clock" id="clock">00:00:00</div>
            <div class="controls">
                <button class="quick-settings-btn" id="quickSettingsBtn">‚ñº</button>
            </div>
            <div class="status-icons">
                <span class="temp">72¬∞F</span>
                <button class="exit-btn" id="exitBtn" title="Exit Application">‚úï</button>
            </div>
        </div>

        <div class="main-content">
            <div class="content-area">
                <div class="home-screen" id="homeScreen">
                    <div class="app-tile" data-app="navigation">
                        <div class="app-icon">üó∫Ô∏è</div>
                        <div class="app-name">Navigation</div>
                    </div>
                    <div class="app-tile" data-app="media">
                        <div class="app-icon">üéµ</div>
                        <div class="app-name">Media</div>
                    </div>
                    <div class="app-tile" data-app="radio">
                        <div class="app-icon">üìª</div>
                        <div class="app-name">Radio</div>
                    </div>
                    <div class="app-tile" data-app="phone">
                        <div class="app-icon">üì±</div>
                        <div class="app-name">CarPlay</div>
                    </div>
                    <div class="app-tile" data-app="settings">
                        <div class="app-icon">‚öôÔ∏è</div>
                        <div class="app-name">Settings</div>
                    </div>
                    <div class="app-tile" data-app="vehicle">
                        <div class="app-icon">üöó</div>
                        <div class="app-name">Vehicle</div>
                    </div>
                </div>

                <!-- CarPlay Interface -->
                <div class="carplay-interface" id="carplayInterface">
                    <div class="carplay-quick-settings">
                        <button class="quick-settings-btn carplay-qs-btn" id="carplayQuickSettingsBtn">‚ñº</button>
                    </div>

                    <div class="carplay-status">
                        <h2>CarPlay</h2>
                        <p id="carplayStatusText">Connect your iPhone to get started</p>
                        <div class="connection-status">
                            <span class="status-dot" id="statusDot"></span>
                            <span id="connectionText">Not Connected</span>
                        </div>
                        <button class="connect-btn" id="connectCarPlayBtn">Connect Device</button>
                    </div>

                    <div class="carplay-screen">
                        <canvas id="carplayCanvas"></canvas>
                        <div class="carplay-placeholder" id="carplayPlaceholder">
                            <div class="icon">üì±</div>
                            <p>Waiting for device connection...</p>
                        </div>
                    </div>
                </div>

                <!-- Radio Interface -->
                <div class="radio-interface" id="radioInterface">
                    <button class="back-btn" id="backBtn">‚Üê</button>

                    <div class="frequency-display">
                        <div class="frequency-number" id="frequencyDisplay">87.5</div>
                        <div class="frequency-label">FM MHz</div>
                        <div class="radio-status" id="radioStatus">üì° Ready</div>
                    </div>

                    <div class="tuner-controls">
                        <button class="seek-btn" id="seekDown">‚èÆ</button>
                        <button class="tune-btn" id="tuneDown">‚àí</button>
                        <button class="tune-btn" id="tuneUp">+</button>
                        <button class="seek-btn" id="seekUp">‚è≠</button>
                    </div>

                    <div class="frequency-slider">
                        <input type="range" id="frequencySlider" min="875" max="1080" value="875" step="1">
                    </div>

                    <div class="presets">
                        <button class="preset-btn" data-preset="1">
                            <div class="preset-number">PRESET 1</div>
                            <div class="preset-freq">88.5</div>
                        </button>
                        <button class="preset-btn" data-preset="2">
                            <div class="preset-number">PRESET 2</div>
                            <div class="preset-freq">95.7</div>
                        </button>
                        <button class="preset-btn" data-preset="3">
                            <div class="preset-number">PRESET 3</div>
                            <div class="preset-freq">101.1</div>
                        </button>
                        <button class="preset-btn" data-preset="4">
                            <div class="preset-number">PRESET 4</div>
                            <div class="preset-freq">104.3</div>
                        </button>
                        <button class="preset-btn" data-preset="5">
                            <div class="preset-number">PRESET 5</div>
                            <div class="preset-freq">106.7</div>
                        </button>
                        <button class="preset-btn" data-preset="6">
                            <div class="preset-number">PRESET 6</div>
                            <div class="preset-freq">107.9</div>
                        </button>
                    </div>
                </div>

                <!-- Music Interface -->
                <div class="music-interface" id="musicInterface">
                    <button class="back-btn" id="musicBackBtn">‚Üê</button>

                    <div class="music-content">
                        <!-- Album Art & Now Playing -->
                        <div class="music-player-main">
                            <button class="toggle-sidebar-btn" id="toggleSidebarBtn">‚ò∞</button>

                            <div class="album-art-container">
                                <img id="albumArt" src="" alt="Album Art" class="album-art">
                                <div class="album-art-placeholder">üéµ</div>
                            </div>

                            <div class="now-playing-info">
                                <div class="track-title" id="trackTitle">No track selected</div>
                                <div class="track-artist" id="trackArtist">‚Äî</div>
                                <div class="track-album" id="trackAlbum">‚Äî</div>
                            </div>

                            <!-- Progress Bar -->
                            <div class="progress-container">
                                <span class="time-display" id="currentTime">0:00</span>
                                <div class="progress-bar" id="progressBar">
                                    <div class="progress-fill" id="progressFill"></div>
                                    <div class="progress-handle" id="progressHandle"></div>
                                </div>
                                <span class="time-display" id="totalTime">0:00</span>
                            </div>

                            <!-- Playback Controls -->
                            <div class="playback-controls">
                                <button class="control-btn" id="prevBtn">‚èÆ</button>
                                <button class="control-btn play-btn" id="playBtn">‚ñ∂</button>
                                <button class="control-btn" id="nextBtn">‚è≠</button>
                                <button class="control-btn" id="shuffleBtn">üîÄ</button>
                                <button class="control-btn" id="repeatBtn">üîÅ</button>
                            </div>

                            <!-- Volume Control -->
                            <div class="volume-container">
                                <span class="volume-icon">üîä</span>
                                <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100"
                                    value="70">
                                <span class="volume-value" id="volumeValue">70%</span>
                            </div>
                        </div>

                        <!-- Playlist Sidebar -->
                        <div class="music-sidebar">
                            <div class="sidebar-header">
                                <h3>Library</h3>
                                <button class="folder-select-btn" id="folderSelectBtn">üìÅ Select</button>
                            </div>

                            <div class="music-folder-display" id="musicFolderPath">
                                No folder selected
                            </div>

                            <div class="search-container">
                                <input type="text" class="search-input" id="playlistSearch" placeholder="Search tracks...">
                                <button class="search-clear" id="searchClear" style="display: none;">√ó</button>
                            </div>

                            <div class="sidebar-controls">
                                <div class="sort-controls">
                                    <label>Sort:</label>
                                    <select class="sort-select" id="sortSelect">
                                        <option value="title">Title</option>
                                        <option value="artist">Artist</option>
                                        <option value="album">Album</option>
                                    </select>
                                </div>
                            </div>

                            <div class="playlist-stats" id="playlistStats">
                                <span>0 tracks</span>
                            </div>

                            <div class="playlist-container" id="playlistContainer">
                                <div class="playlist-empty">
                                    <div class="empty-icon">üéµ</div>
                                    <p>No music files found</p>
                                    <p class="empty-hint">Select a folder with audio files</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Interface -->
                <div class="settings-interface" id="settingsInterface">
                    <button class="back-btn" id="settingsBackBtn">‚Üê</button>

                    <div class="settings-content">
                        <h2 class="settings-title">Settings</h2>

                        <div class="settings-section">
                            <h3 class="section-title">Window</h3>
                            <div class="setting-item">
                                <label>Width</label>
                                <input type="number" id="windowWidth" min="800" max="3840" step="10">
                            </div>
                            <div class="setting-item">
                                <label>Height</label>
                                <input type="number" id="windowHeight" min="600" max="2160" step="10">
                            </div>
                            <div class="setting-item">
                                <label>Fullscreen</label>
                                <input type="checkbox" id="windowFullscreen">
                            </div>
                        </div>

                        <div class="settings-section">
                            <h3 class="section-title">Audio</h3>
                            <div class="setting-item">
                                <label>Microphone Enabled</label>
                                <input type="checkbox" id="micEnabled">
                            </div>
                            <div class="setting-item">
                                <label>Echo Cancellation</label>
                                <input type="checkbox" id="echoCancellation">
                            </div>
                            <div class="setting-item">
                                <label>Noise Suppression</label>
                                <input type="checkbox" id="noiseSuppression">
                            </div>
                            <div class="setting-item">
                                <label>Auto Gain Control</label>
                                <input type="checkbox" id="autoGainControl">
                            </div>
                        </div>

                        <div class="settings-section">
                            <h3 class="section-title">Display</h3>
                            <div class="setting-item">
                                <label>Default Brightness (%)</label>
                                <input type="number" id="defaultBrightness" min="0" max="100" step="5">
                            </div>
                            <div class="setting-item">
                                <label>Clock Format</label>
                                <select id="clockFormat">
                                    <option value="12hr">12 Hour</option>
                                    <option value="24hr">24 Hour</option>
                                </select>
                            </div>
                            <div class="setting-item">
                                <label>Show Seconds</label>
                                <input type="checkbox" id="showSeconds">
                            </div>
                            <div class="setting-item">
                                <label>Temperature Unit</label>
                                <select id="temperatureUnit">
                                    <option value="fahrenheit">Fahrenheit (¬∞F)</option>
                                    <option value="celsius">Celsius (¬∞C)</option>
                                </select>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h3 class="section-title">Radio Presets</h3>
                            <div class="presets-editor" id="presetsEditor">
                            </div>
                        </div>

                        <div class="settings-section">
                            <h3 class="section-title">CarPlay</h3>
                            <div class="setting-item">
                                <label>Width (px)</label>
                                <input type="number" id="carplayWidth" min="640" max="1920" step="10"
                                    placeholder="Auto">
                            </div>
                            <div class="setting-item">
                                <label>Height (px)</label>
                                <input type="number" id="carplayHeight" min="480" max="1080" step="10"
                                    placeholder="Auto">
                            </div>
                            <div class="setting-item">
                                <label>FPS</label>
                                <input type="number" id="carplayFps" min="10" max="60" step="1">
                            </div>
                            <div class="setting-item">
                                <label>DPI</label>
                                <input type="number" id="carplayDpi" min="72" max="320" step="10">
                            </div>
                            <div class="setting-item">
                                <label>Box Name</label>
                                <input type="text" id="carplayBoxName" maxlength="16" placeholder="nodePlay">
                            </div>
                            <div class="setting-item">
                                <label>Driving Position</label>
                                <select id="carplayHand">
                                    <option value="0">Left Hand Drive (LHD)</option>
                                    <option value="1">Right Hand Drive (RHD)</option>
                                </select>
                            </div>
                        </div>

                        <div class="settings-actions">
                            <button class="settings-btn save-btn" id="saveSettingsBtn">Save Settings</button>
                            <button class="settings-btn reset-btn" id="resetSettingsBtn">Reset to Defaults</button>
                        </div>

                        <div class="settings-status" id="settingsStatus"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="nav-bar">
            <button class="nav-btn active">üè†</button>
            <button class="nav-btn">üó∫Ô∏è</button>
            <button class="nav-btn">üéµ</button>
            <button class="nav-btn">üìû</button>
            <button class="nav-btn">‚öôÔ∏è</button>
        </div>
    </div>

    <!-- Non-module script for basic controls -->
    <script src="src/js/controls.js"></script>

    <!-- Music Player -->
    <script src="src/js/music-player.js"></script>

    <!-- App Integration -->
    <script src="src/js/app-integration.js"></script>

    <!-- ES6 module script for CarPlay and app functionality -->
    <script type="module" src="src/js/app.js"></script>
</body>

</html>